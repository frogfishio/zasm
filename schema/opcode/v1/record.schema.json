{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://frogfish.io/zasm/schema/opcode/v1/record.schema.json",
  "title": "zasm opcode stream v1 JSONL record",
  "description": "One JSON object per line (JSONL). Each line must validate against one of the record variants.",
  "oneOf": [
    {
      "$ref": "#/$defs/OpRecord"
    },
    {
      "$ref": "#/$defs/BytesRecord"
    }
  ],
  "$defs": {
    "Loc": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "line"
      ],
      "properties": {
        "line": {
          "type": "integer",
          "minimum": 1
        },
        "col": {
          "type": "integer",
          "minimum": 1
        },
        "unit": {
          "type": "string",
          "description": "Optional compilation unit id / filename / namespace hint."
        }
      }
    },
    "U32": {
      "type": "integer",
      "minimum": 0,
      "maximum": 4294967295
    },
    "OpRecord": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "ir",
        "k",
        "op",
        "rd",
        "rs1",
        "rs2",
        "imm12"
      ],
      "properties": {
        "ir": {
          "const": "zasm-opcodes-v1"
        },
        "k": {
          "const": "op"
        },
        "op": {
          "type": "integer",
          "minimum": 0,
          "maximum": 255
        },
        "rd": {
          "type": "integer",
          "minimum": 0,
          "maximum": 15
        },
        "rs1": {
          "type": "integer",
          "minimum": 0,
          "maximum": 15
        },
        "rs2": {
          "type": "integer",
          "minimum": 0,
          "maximum": 15
        },
        "imm12": {
          "type": "integer",
          "minimum": -2048,
          "maximum": 2047
        },
        "ext": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/U32"
          },
          "minItems": 0,
          "maxItems": 2
        },
        "m": {
          "type": "string",
          "minLength": 1
        },
        "loc": {
          "$ref": "#/$defs/Loc"
        }
      }
    },
    "BytesRecord": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "ir",
        "k",
        "hex"
      ],
      "properties": {
        "ir": {
          "const": "zasm-opcodes-v1"
        },
        "k": {
          "const": "bytes"
        },
        "hex": {
          "type": "string",
          "minLength": 2,
          "pattern": "^(?:[0-9A-Fa-f]{2})+$"
        },
        "loc": {
          "$ref": "#/$defs/Loc"
        }
      }
    }
  }
}
